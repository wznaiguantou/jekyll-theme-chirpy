---
layout: post
title:  "我对Kafka的问题"
date:   2022-01-19 00:08:04 +0800
categories: Kafka
---

### 一、面试题

- 能否做到分区扩容，缩容？如果不能改怎么办？



  分区扩增是可以做到的。这个本身是Kafka支持的一个特性。在扩增partition之后，生产者/消费者都能通过metadataRequest感知到最新的分区数量，而且在这个时候，是会被分区重分配暂定消费的。

  在Topic 扩增分区之后，会生成新的分区的leader，并且需要在最近一次的metadata信息里进行维护并返回给生产者、消费者。

  - 生产者：

    Case:  业务上无论是否对消息进行分区的固定划分，即Key 是否为null，都会影响旧key落在原有的partition内。

    那么分区器会按照新的分区数量进行消息路由。

  - 消费者：

    Case1 :  没有消息逻辑划分

    业务上没有预期指定key的消息落在同样一个partition内，那么消息的业务顺序性是不关注的，也就不在意

    Case2 : 有逻辑划分

    这里怎么保证一个key=key1，原本落在partition2的消息，扩容了之后还会落在partition上？



- 如果真的可以扩容分区, 那么分区原有的副本怎么办？它会移动么？我指的是副本会迁移到别的broker上么？

  不会，这里需要借助kafka的分区重分配工具，让broker的分区重新移动。



- 那如果我是扩容broker呢？对应的已经存在的那些Topic 怎么办？分区怎么处理？

  同上，无论是新增broker 节点，还是broker完全宕机了也好，分区的数据迁移需要依靠kafka的分区重分配工具进行迁移。



- Kafka的用途有哪些？使用场景如何？

  Kafka 是一个分布式的高性能事件流平台。



  按照事件流平台这个维度，那我们可以做什么事情，

  1. 可以作为一个架构的消息中间件，让一个耦合在一起的系统松耦合。
  2. 可以作为一个DB存在，保存数据最后的数据状态。read_uncommited or read_commited



  接着是保证了消息系统的高可用、高性能。



- Kafka中的ISR、AR又代表什么？ISR的伸缩又指什么

ISR = In Sync Replicas, 表示正在同步的服务集合

AR = Assigned Replicas, 即每个partition 所有的副本，包括leader。

ISR的伸缩性指的是，可以动态的新增或者删除一个topic 的副本因子，让其为1或者>1 < brokers num.













- Kafka中的HW、LEO、LSO、LW等分别代表什么？
- Kafka中是怎么体现消息顺序性的？
- Kafka中的分区器、序列化器、拦截器是否了解？它们之间的处理顺序是什么？
- Kafka生产者客户端的整体结构是什么样子的？
- Kafka生产者客户端中使用了几个线程来处理？分别是什么？
- Kafka的旧版Scala的消费者客户端的设计有什么缺陷？
- 消费组中的消费者个数如果超过topic的分区，那么就会有消费者消费不到数据”这句话是否正确？如果正确，那么有没有什么hack的手段？
- 消费者提交消费位移时提交的是当前消费到的最新消息的offset还是offset+1?
- 有哪些情形会造成重复消费？
- 那些情景下会造成消息漏消费？
- KafkaConsumer是非线程安全的，那么怎么样实现多线程消费？
- 简述消费者与消费组之间的关系
- 当你使用kafka-topics.sh创建（删除）了一个topic之后，Kafka背后会执行什么逻辑？
- topic的分区数可不可以增加？如果可以怎么增加？如果不可以，那又是为什么？
- topic的分区数可不可以减少？如果可以怎么减少？如果不可以，那又是为什么？
- 创建topic时如何选择合适的分区数？
- Kafka目前有哪些内部topic，它们都有什么特征？各自的作用又是什么？
- 优先副本是什么？它有什么特殊的作用？
- Kafka有哪几处地方有分区分配的概念？简述大致的过程及原理。
- 简述Kafka的日志目录结构
- Kafka中有那些索引文件？
- 如果我指定了一个offset，Kafka怎么查找到对应的消息？
- 如果我指定了一个timestamp，Kafka怎么查找到对应的消息？
- 聊一聊你对Kafka的Log Retention的理解
- 聊一聊你对Kafka的Log Compaction的理解
- 聊一聊你对Kafka底层存储的理解（页缓存、内核层、块层、设备层）
- 聊一聊Kafka的延时操作的原理
- 聊一聊Kafka控制器的作用
- 消费再均衡的原理是什么？（提示：消费者协调器和消费组协调器）
- Kafka中的幂等是怎么实现的？
- Kafka中的事务是怎么实现的？
- Kafka中有那些地方需要选举？这些地方的选举策略又有哪些？
- 失效副本是指什么？有那些应对措施？
- 多副本下，各个副本中的HW和LEO的演变过程
- 为什么Kafka不支持读写分离？
- Kafka在可靠性方面做了哪些改进？（HW, LeaderEpoch）
- Kafka中怎么实现死信队列和重试队列？
- Kafka中的延迟队列怎么实现
- Kafka中怎么做消息审计？
- Kafka中怎么做消息轨迹？
- Kafka中有那些配置参数比较有意思？聊一聊你的看法
- Kafka中有那些命名比较有意思？聊一聊你的看法
- Kafka有哪些指标需要着重关注？
- 怎么计算Lag？(注意read_uncommitted和read_committed状态下的不同)
- Kafka的那些设计让它有如此高的性能？
- Kafka有什么优缺点？
- 还用过什么同质类的其它产品，与Kafka相比有什么优缺点？
- 为什么选择Kafka?
- 在使用Kafka的过程中遇到过什么困难？怎么解决的？
- 怎么样才能确保Kafka极大程度上的可靠性？
- 聊一聊你对Kafka生态的理解







